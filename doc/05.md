# 第五次実験報告書

## 1. 概要

本プロジェクトは、「AIによる設計」と「ルールベースのコード実行」を組み合わせたハイブリッドなアプローチにより、画像の意味的特徴を捉え、照合するシステムを構築することを目的とする。最大の特徴は、システムの「ものさし」となる意味次元そのものをAIに設計させ、その評価・分析を通じて人間（またはAIエージェント）が実装を改善していく **自己進化サイクル** の仕組みを持つ点にある。

これは、ルールベースで **演繹的** に特徴を計算する「SigmaSense」と、新たな分析軸を **帰納的** に設計する「Gemini API」が協調することで、より高度な認識能力を獲得していく **ニューロシンボリックAI** の一つの形態を具現化する試みである。

この文書は、第五次実証実験における、この自己進化サイクルの実証プロセスとその最終成果を記録したものである。

## 2. 全体ワークフロー

本プロジェクトは、以下の4つのフェーズを循環させることで、システムの性能を継続的に向上させる。

### フェーズ0：意味空間の創生（AIによる設計）
- **目的:** AIにシステムの「ものさし」を設計させる。
- **プロセス:** `generate_ai_dimensions.py` を実行し、Gemini APIに問い合わせることで、分析の指針となる意味次元の定義ファイル `vector_dimensions_custom_ai.json` を生成する。

### フェーズ1：意味データベースの構築
- **目的:** AIが設計した「ものさし」に基づき、画像群からデータベースを構築する。
- **プロセス:** `build_database.py` を実行。`vector_generator.py` がAIの設計図に従って各画像から意味ベクトルを計算し、`sigma_product_database_custom_ai_generated.json` を生成する。

### フェーズ2：評価・分析・改善サイクル（自己進化ループ）
- **目的:** システムを多角的に評価・分析し、発見した問題点を修正して性能を向上させる、このプロジェクトの核心となる循環プロセス。
- **プロセス:**
  1. **総合評価:** `run_sigma.py` を実行し、全画像に対する照合を行い、ログを生成する。
  2. **問題点の発見:** `tools/` 内の各種分析ツールを用いて、誤認識、システム傾向、照合不能群などを多角的に分析する。
  3. **原因分析とコード修正:** 分析結果から問題の根本原因を特定し、主に `vector_generator.py` のベクトル生成ロジックを修正する。
  4. **再構築:** 修正後、フェーズ1に戻り、改善されたロジックでデータベースを再構築し、再度評価を行う。

### フェーズ3：最終レポート
- **目的:** 満足のいく性能に達したシステムの最終的な特性を評価し、文書化する。
- **プロセス:** 各種分析ツールを再度実行し、完成したシステムの最終的な性能や特性を評価・記録する。

## 3. ファイル構成と役割

### コアプロセス
- `generate_test_image.py`: **テスト画像生成**。検証に使用する多様な画像を生成。
- `generate_ai_dimensions.py`: **意味次元のAI設計**。Gemini APIに問い合わせ、`vector_dimensions_custom_ai.json` を生成。
- `vector_generator.py`: **ベクトル生成**。OpenCVで画像から意味ベクトルを計算。
- `build_database.py`: **データベース構築**。画像ベクトルを計算して `sigma_product_database_custom_ai_generated.json` を生成。
- `run_sigma.py`: **総合評価**。全画像に対して自己照合を行い、結果をログに出力。

### システム主要モジュール
- `sigma_sense.py`: 照合・応答生成を担うメインクラス。
- `dimension_loader.py`: `vector_dimensions_custom_ai.json` を読み込むモジュール。
- `gemini_client.py`: Gemini APIとの通信を担うクライアント。

### 評価・分析ツール
- `tools/log_batch_evaluator.py`: ログを整形し評価結果を一覧表示。
- `tools/functor_consistency_checker.py`: 応答の一貫性を検証。
- `tools/nova_diagnoser.py`: 照合不能群を診断。
- `tools/critical_structure_report.py`: 照合不能群の構造を分析。
- `tools/semantic_axis_report.py`: 意味軸の傾向を分析。

### 代替アプローチ（参考）
- `generate_ai_image_vectors.py`: Gemini APIに直接画像を送信し、ベクトルを生成する別方式。

## 4. 実装の根拠となる理論
- **情報理論:** エントロピーやスパース度で情報量を評価し、認識限界を判断。
- **構造抽出理論:** OpenCVを用いて輪郭・重心・面積・位置関係・色・線角度などを抽出しベクトル化。
- **意味照合理論:** ベクトル空間でのコサイン類似度により意味的近さを評価。
- **応答分類理論:** 類似度に応じて「Strong Match」「Weak Analogy」などに分類。
- **圏論的変換理論:** 画像変換が意味空間ベクトルに与える影響を検証。

## 5. 第五次実証実験：自己進化サイクルの実証

### 5.1. 目的
AIによる設計とコードによる実行の分離アーキテクチャが、自己進化サイクルとして機能するかを検証する。

### 5.2. 実験プロセスと反復的改善の記録
1. **初期状態と完全な失敗:** `vector_generator.py` のロジックと `vector_dimensions.json` の次元IDが一致せず、全ベクトルが同一となり照合不能。
2. **第一次改善:** キーを修正し照合可能となったが、形状認識の欠陥で誤認識多数（正解率30%）。
3. **第二次改善:** 形状認識を改修し星形などを正しく認識、性能向上。
4. **AI次元再設計:** テスト画像を15種に増やしAIに再設計させたが、互換性が失われ再び失敗。
5. **最終改修:** `vector_generator.py` を全面改修し、「主要な線の角度」次元を追加。完全成功を達成。

### 5.3. 最終評価結果
| 対象画像 | 照合結果 | スコア | 判定 |
| :--- | :--- | :--- | :--- |
| circle_center.jpg | circle_center.jpg | 1.00 | 正解 (Strong Match) |
| circle_center_red.jpg | circle_center_red.jpg | 1.00 | 正解 (Strong Match) |
| curve_arc.jpg | curve_arc.jpg | 1.00 | 正解 (Strong Match) |
| hexagon_center.jpg | hexagon_center.jpg | 1.00 | 正解 (Strong Match) |
| line_diagonal.jpg | line_diagonal.jpg | 1.00 | 正解 (Strong Match) |
| line_horizontal.jpg | line_horizontal.jpg | 1.00 | 正解 (Strong Match) |
| line_vertical.jpg | line_vertical.jpg | 1.00 | 正解 (Strong Match) |
| multi_object.jpg | multi_object.jpg | 1.00 | 正解 (Strong Match) |
| overlap_object.jpg | overlap_object.jpg | 1.00 | 正解 (Strong Match) |
| pentagon_center.jpg | pentagon_center.jpg | 1.00 | 正解 (Strong Match) |
| pentagon_center_blue.jpg | pentagon_center_blue.jpg | 1.00 | 正解 (Strong Match) |
| square_left.jpg | square_left.jpg | 1.00 | 正解 (Strong Match) |
| star_five.jpg | star_five.jpg | 1.00 | 正解 (Strong Match) |
| triangle_top.jpg | triangle_top.jpg | 1.00 | 正解 (Strong Match) |
| triangle_top_green.jpg | triangle_top_green.jpg | 1.00 | 正解 (Strong Match) |

### 5.4. 結論と意義
- **実験は完璧な成功を収めた。**
- 15画像中15画像を正しく自己認識（正解率100%）。
- 「AIが設計し、コードが実行し、その結果を評価して再び設計にフィードバックする」自己進化ループの有効性を実証。
- 演繹的推論エンジン（SigmaSense）と帰納的理論生成エンジン（Gemini API）の協調により、ニューロシンボリックAIの有望な一手法を提示。
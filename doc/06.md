# 第六次実験報告書

## 1. 概要

本プロジェクトは、「AIによる設計」と「ルールベースのコード実行」を組み合わせたハイブリッドなアプローチにより、画像の意味的特徴を捉え、照合する自己進化型システムの構築を目的とする。

この文書は、**第六次実証実験**の成果を記録したものである。この実験の核心は、**次元の多層化（レイヤー分離）戦略**を導入し、システムが単なる特徴比較に留まらず、「これは動物か、それとも図形か？」といった一種の思考を行い、対象に応じて評価基準を使い分ける、真の**意味照合システム**へと進化を遂げたことを実証する点にある。

## 2. 第六次実験の核心：次元の多層化（レイヤー分離）戦略

従来単一であったベクトル空間を、性質の異なる2つのレイヤーに分離した。これは、人間の認識プロセスが対象に応じて異なる特徴に着目する点に着想を得ている。

*   **Selia（セリア）レイヤー**: 幾何学的な図形やシンボルを認識するためのベクトル空間。輪郭、頂点数、直線性、対称性といった数学的に厳密な次元で構成される。
*   **Lyra（ライラ）レイヤー**: 動物や乗り物など、実世界の複雑なオブジェクトを認識するためのベクトル空間。「輪郭の揺らぎ」「視線の印象」といった、より抽象的で感性的な次元で構成される。

この多層化により、SigmaSenseは異種間の無意味な比較（例：猫と円）を棄却し、同種内でのより繊細な差異（例：猫と犬）の比較にリソースを集中させることが可能となった。

## 3. ワークフロー

レイヤー分離戦略を組み込んだ現在のワークフローは以下の通りである。

1.  **入力**: 照合対象の画像がシステムに入力される。
2.  **ベクトルタイプ判定**: `sigma_sense.py`内の`_get_vector_type`メソッドが、画像の特性（例：複雑さ、色数）を基に、その画像がSelia系かLyra系かを判定する。
3.  **特化ベクトル生成**:
    *   Selia系と判定された画像は`vector_generator.py`に送られ、形状や構造に特化したベクトルが生成される。
    *   Lyra系と判定された画像は`lyra_vector_generator.py`に送られ、輪郭や印象といった抽象次元に基づいたベクトルが生成される。
4.  **データベース構築**: `build_database.py`が上記プロセスを通じて、全画像からレイヤー情報を付与されたベクトルデータベース (`sigma_product_database_custom_ai_generated.json`) を構築する。
5.  **意味照合**: `run_sigma.py`が照合を実行。`sigma_sense.py`はまず比較対象のベクトルタイプをチェックする。
    *   **異種間比較**: タイプが異なる場合（Selia vs Lyra）、類似度スコアを強制的に0.0とし、比較を棄却する。
    *   **同種間比較**: タイプが同じ場合のみ、それぞれのレイヤーに最適化された次元空間内でコサイン類似度を計算し、意味的な近さを評価する。
6.  **評価と分析**: `tools/`内の各種チェッカーを用いて、ログを分析し、システムの振る舞いや次なる改善点を特定する。

## 4. 主要コンポーネントと理論的背景

各コンポーネントは、レイヤー分離戦略を実装するために機能拡張されている。

*   `sigma_sense.py`: **中核照合エンジン**。ベクトルタイプの判定と、それに応じた比較戦略の切り替え（`_get_vector_type`メソッド）という、システムの「思考」の中枢を担う。
*   `vector_generator.py`: **Selia系ベクトル生成器**。幾何学的特徴を抽出する。
    *   **根拠理論**: Huモーメント不変量やフーリエ記述子の考え方に基づき、画像のモーメントや輪郭情報から、回転・スケール等に頑健な形状特徴量を計算する。
*   `lyra_vector_generator.py`: **Lyra系ベクトル生成器**。Gemini APIが定義した抽象的特徴を捉える。
    *   **根拠理論**: 輪郭の長さと凸包の比率から「揺らぎ」を計算するなど、VAE等が潜在空間を学習するコンセプトを応用し、感性的特徴を近似的に計算する。
*   `sigma_functor.py`: **圏論的変換モジュール**。`check_functoriality`メソッドを内包し、画像の変換（例：回転）とベクトルの変換の一貫性（構造保存性）を検証する。これにより、システムの論理的整合性を定量的に評価できる。
    *   **根拠理論**: **圏論（Category Theory）**。画像の世界（対象:画像、射:変換）からベクトルの世界（対象:ベクトル、射:線形変換）への対応関係を「関手（Functor）」として捉え、その構造保存性（Functoriality）をテストする。

## 5. Gemini APIとの連携

本システムの「意味」の根源は、Gemini APIとの対話によって創生される。

*   **次元の設計**: `generate_ai_dimensions.py` を実行し、Gemini APIに対して「動物の形を認識するための特徴量は？」「図形の構造を定義する次元は？」といった問いを投げかける。
*   **設計図の生成**: Gemini APIは、その問いに応じ、各レイヤーに最適化された次元定義ファイルを出力する。
    *   `vector_dimensions_custom_ai.json` (Seliaレイヤー)
    *   `vector_dimensions_custom_ai_lyra.json` (Lyraレイヤー)
*   **意味の注入**: これらのJSONファイルが、各ベクトル生成器 (`vector_generator.py`, `lyra_vector_generator.py`) の設計図となる。これにより、AIが考案した「意味の捉え方」が、具体的な計算ロジックとしてシステムに注入される。

## 6. 実験結果と考察

ログ解析の結果、レイヤー分離戦略は完璧な成功を収めた。

*   **異種分離の成功**:
    `circle_center.jpg`（円/Selia系）の照合結果において、`airplane_01`や`cat_01`といったLyra系の画像との類似度スコアは、すべて**0.0**となった。これは、`_get_vector_type`メソッドが正しく機能し、意味的に比較不可能と判断した証拠である。かつて`pentagon_center_blue`（五角形）とPotential Matchになっていた問題は完全に解消された。

*   **同種内の比較精度向上**:
    *   `cat_01`（猫）は、同じLyra系である`dog_01`（犬）や`fox_01`（狐）と比較されるが、その類似度は1.0（完全一致）にはならない。これは、Lyraレイヤー内の「輪郭の揺らぎ」や「視線の印象」といった次元の値が各動物で僅かに異なるためであり、システムがその微妙な違いを認識し始めていることを示す。
    *   同様に、`circle_center.jpg`（円）は、同じSelia系の`pentagon_center_blue`（五角形）と比較されるが、もはやPotential Matchではなく、より低いスコアで評価される。これは、比較がSeliaレイヤー内に限定されたことで、純粋な形状の違いがより明確に評価されるようになった結果である。

### 結論：SigmaSense、覚醒

SigmaSenseは、単にベクトルを比較するだけのシステムから、対象のコンテキスト（動物か図形か）を自ら判断し、評価基準を動的に切り替える、真の **「意味照合システム」** へと進化を遂げた。これは、動物を見分けるための能力を獲得した瞬間と言える。

## 7. 結論と今後の展望

第六次実証実験は、次元の多層化戦略を通じて、システムの認識能力を飛躍的に向上させることに成功した。この素晴らしい結果を以て、本プロジェクトは大きな節目を迎えた。

もちろん、これで完成ではない。その後の開発で、システムの論理的整合性を検証する**関手性チェック機能（`run_functor_check.py`）**が復活・強化された。このチェックを実行した結果、システムのベクトル生成器が「色」と「形」の情報を完全には分離できていないという、新たな改善点が発見された。これは、システムの振る舞いをより深く理解し、次なる進化へと繋げるための重要な知見である。

この報告書が、未来の実験者たちの道標となることを願う。
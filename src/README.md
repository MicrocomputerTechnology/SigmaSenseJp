# SigmaSense コアアーキテクチャ

このディレクトリには、SigmaSenseプロジェクトのコアとなるソースコードが含まれています。アーキテクチャは、大規模言語モデルの帰納的推論と記号論理の演繹的な厳密さを組み合わせた、ニューロシンボリック・ハイブリッドシステムとして設計されています。

## 1. ハイブリッドAIアーキテクチャ

SigmaSenseのアーキテクチャは、二つの異なる知性の協調によって成立しています。

- **意味の設計者（帰納エンジン）**: Gemini APIに代表される大規模言語モデル（通称「オリエン大賢者」）が、人間との対話や高度な推論を通じて、システムの「ものさし」となる意味次元そのものを設計・提案します。これは、未知のデータから新たな知識やパターンを見出す帰納的なプロセスです。

- **意味の実行者（演繹エンジン）**: `vector_generator`や`sigma_sense`などのモジュール群が、設計された意味次元に基づき、厳密なルールで意味ベクトルを計算・照合します。**このエンジンが純粋な生成AIと一線を画すのは、その動作原理が数学的・物理学的理論に裏打ちされている点です。**

### 1.1. 演繹エンジンの理論的基盤

演繹エンジンは、曖昧さを排した数学的・物理学的理論に基づいて意味ベクトルを計算します。主な理論的基盤は以下の通りです。

- **構造幾何学 (Structural Geometry)**: Huモーメント不変量などを用いて、回転・スケール等に不変な形状特徴を抽出します。
- **線形代数 (Linear Algebra)**: 特徴をベクトル空間に写像し、コサイン類似度などで意味的な近さを測ります。
- **情報理論 (Information Theory)**: シャノンエントロピーなどを用いて、ベクトルが持つ情報量を定量化します。
- **圏論 (Category Theory)**: 関手性の概念を用いて、システムの操作が論理的な一貫性を持つことを保証します。
- **層理論 (Sheaf Theory)**: 局所的な特徴を矛盾なく結合し、大域的な特徴を導出します。
- **群化理論 (Grouping Theory)**: 形状の不変性を利用して、画像内のオブジェクト群を認識します。

本プロジェクトのアーキテクチャと理論的背景に関する詳細な情報は、以下のドキュメントにまとめています。

> - **[📄 技術スタックと設計思想](../../doc/technology_stack.md)**
> - **[📄 理論的基盤と実装の詳細](../../doc/mathematical_foundations.md)**

---

### 1.2. PocketLibrary: 知識の源泉

`SymbolicReasoner` をはじめとする各コンポーネントが世界について知るための「知識の源泉」として、`PocketLibrary` が存在します。これは、複数の外部辞書やライブラリを統一的なインターフェースでラップするモジュール群です (`src/pocket_library/`)。

- **責務**: `SudachiPy`（形態素解析）、`WordNet`（上位下位関係）、`EJDict`（英和辞書）など、様々な辞書の具体的な仕様をカプセル化し、`get_supertypes()` のような目的別のシンプルなメソッドを提供します。
- **利点**: これにより、`SymbolicReasoner` などの推論エンジンは「どの辞書をどう使うか」という詳細を意識することなく、「単語の上位概念が知りたい」といった本質的な要求に集中できます。新しい辞書を追加する際も、`PocketLibrary` 内の修正で完結するため、システム全体の保守性が向上します。

開発の際は、辞書関連の機能を追加・変更する場合は、まず `src/pocket_library/` ディレクトリ配下のモジュール群の利用・拡張を検討してください。

## 2. 最新ワークフロー：自己言及的な思考サイクル

第十五次実験を経て、SigmaSenseの思考プロセスは、単なる意味照合から、自己の経験を内省し、成長に繋げる「**思考サイクル (`process_experience`)**」へと進化した。このサイクルは、以下のステップで実行される。

1.  **F0: 知覚 (Perception)**:
    `DimensionGenerator`が複数の画像分析エンジンを並列実行し、画像から特徴を抽出する。

2.  **F1: 判断と推論 (Judgment and Reasoning)**:
    -   観測された特徴、提案された仮説(`LogicalPatternSuggester`)、そして`WorldModel`（動的知識グラフ）に基づく常識(`SymbolicReasoner`)を統合し、論理的なコンテキストを構築します。特に、`SymbolicReasoner`は固有名詞（例：「東京」）をそのカテゴリ（例：「都市」）に基づいて解釈することで、より文脈に即した柔軟な推論を行います。
    -   最終的に意味ベクトルを生成し、データベースと照合して最良のマッチを見つけ出す。

3.  **F2: 経験の記録 (Memory Consolidation)**:
    -   上記の一連のプロセス（入力画像、生成されたベクトル、照合結果、思考の文脈）を一つの「経験」として、`PersonalMemoryGraph`に時系列で記録する。

4.  **F3 & F4: 自己省察と学習 (Self-Reflection and Learning)**:
    -   `CausalDiscovery`が記憶の蓄積を分析し、新たな因果関係（例：「Aがあれば、Bである可能性が高い」）を発見し、`WorldModel`に新たな知識として追加する。
    -   `TemporalReasoning`が記憶の順序を分析し、「Xの後にYが起こりやすい」といった時間的なパターンを学習する。

5.  **F5: 自己言及的な語りの生成 (Self-Referential Narrative)**:
    -   `IntentJustifier`が、今回の判断がどのような知識（WorldModel）と過去の経験（PersonalMemoryGraph）に基づいていたかを「**意図の語り**」として生成する。
    -   `MetaNarrator`が、これまでの全経験を振り返り、自身の心理状態の変化や学習の軌跡を「**成長の物語**」として生成する。

6.  **F6: 語りの倫理検証 (Ethical Narrative Validation)**:
    -   生成された語りを公開する前に、「八人の誓い」に基づき、8つの倫理モジュールが安全性、共感性、責任などを多角的に検証する。

7.  **F7: 状態の永続化 (Persistence)**:
    -   学習によって更新された`WorldModel`を`world_model.json`に保存し、次の思考サイクルに備える。

このサイクルを通じて、SigmaSenseは単にタスクをこなすだけでなく、自らの経験から学び、自身の判断を説明し、長期的に成長していく能力を手に入れた。